# -*- coding: utf-8 -*-
"""British_Columbia 2019 GFP Expression Model.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1EKkZe4Ykm_-xQR4lW9OYMhAcoLk_ZHgq

#iGEM 2019 GFP Expression Model

##Modelling Goals

* Model the sensing device: input is toxin concentration in enviornment and output is GFP expression

* Investigate how the system changes as a function of:
  * Change in substrate (toxin) concentration
  * Change of promoter strength (biosensor and GFP promoters)
  * Change of population size

* Enhance our understanding of the sensing device, and help optimize parameters for integration into a physical device in the future

## Ordinary Differential Equation Model

### Circuit Design Assumptions:

* Biosensor is constitutively expressed in the cell
* Toxin can enter the cell by simple diffusion
* When biosensor is bound to toxin, it induces expression of GFP

### Differential Equations:

1. Rate of change of biosensor concentration
>>  $ \frac{dBSN}{dt} = P_{BSN} \cdot \frac{1}{BSN} - D_{BSN}$

Rate of change of biosensor concentration in the cell is based on promoter activity of the biosensor (new molecules made) subtracted from the degradation of the biosensor

2. Rate of change of bound (active) biosensor concentration
>>  $ \frac{dBSN_a}{dt} = \frac {1}{1 +  \frac {K_B}{[TXN]}} \cdot {BSN}$

Rate of change of bound (active) biosensor is described by the Hill Equation, which in this format gives the fraction of receptor protein (BSN) concentration that is bound by the ligand (TXN). We multiply this by the concentraion of BSN in the cell to get the total number of active BSN molecules.

3. GFP promoter binding:
>> $ \frac{P_{GFP}}{dt} = \frac {1}{1 +  \frac {K_C}{[BSN_a]}}$

GFP promoter binding is also described by the Hill Equation. In this case, nothing is multiplied since number of promoters in the cell is probably very low (close to 1).

4. Biosensor Degradation
>>  $ D_{BSN} = D_{max} \cdot \frac{BSN}{BSN + K_A}$

Biosensor degradation is described by Micahelis-Mentin Kinetics, where $D_{max}$ is the maximum proteolytic activity (BSN per cell per hour) and KA represents the BSN concentration at which degradation is half $D_{max}$

### Explanation and Assumptions

* $P_{BSN}$: Biosensor promoter activity, combination of transcription initiation rate, mRNA stability, translation efficency, etc. -> adapted from paper

* Biosensor degradation follows Michaelis-Menten kinetics

* Rate of change of bound (active) biosensor concentration is modelled after Hill's equation with tthe hill co-efficient set to 1 under the assumption of independent binding

* GFP promoter binding is also based on Hill's Equation with the same assumption above

* **Currently there's a jump from binding to the GFP promoter to GFP Expression below, we can add one more equation to make this more realistic. Experiments needed to incorporate this**

### Constants:

* $P_{BSN} = 100 $ -> Just an assumption, would help to find value from literature to support it

* $D_{max} = 232 \ RNU \ OD^{-1} \ h^{-1}$  -> This is the value for GFP, we can use same value here for now

* $K_A = ?$ ->assume constant for simulation

* $K_B = ?$ ->assume constant for simulation

* $K_C = ?$ ->assume constant for simulation

### Legend:

* $BSN$: Cell content of Biosensor
* $BSN_1$: cell content of active biosensor (bound to toxin).
* $P_{BSN}$: Biosensor promoter activity
* $D_BSN$: Degradation rate of $BSN$ ($/hour$)
* $TXN$: Cell content of toxin
* $t$: Time ($hours$)
* $K_A$: Saturation constant for protesomes concerned with biosensor
* $K_B$: Toxin concentration producing half occupation of biosensor
* $K_C$: Active biosensor concentration producing half occupation of promoter region

## Model for GFP Expression

### Components (within a single cell):
* Rate of synthesis of non-fluorescent GFP ($^nGFP$) from gene fused to promoter $P_{GFP}$
* Rate of maturation of $^nGFP$ to fluorescent GFP ($^fGFP$)
* Growth rate of the bacterium ($\mu$)
* Rate of degradation of ($^nGFP$) and ($^fGFP$)

### Differential Equations:

1. Rate of change of $^fGFP$:
>>  $ \frac{d ^nGFP}{dt} = m \cdot n - \mu \cdot f - D_f$

2. Rate of change of $^nGFP$:
>> $ \frac{d ^nGFP}{dt} = P_{GFP} - m \cdot n - \mu \cdot n - D_n$

4. Rate of degradation of $D_f$:
>>  $ \frac{dD_f}{dt} = D_{max} \cdot \frac{f}{n + f + K_m}$

3. Rate of degradation of $D_n$:
>>  $ \frac{dD_n}{dt} = D_{max} \cdot \frac{n}{n + f + K_m}$

### Constants:

* $m = \frac {\ln2}{T_{GFPm}}$

* $\mu = 0.22 h^{-1} $ to $0.77 h^{-1}$ -> from E.coli paper

* $D_{max} = 232 \ RNU \ OD^{-1} \ h^{-1}$  -> from paper

* $K_M = 35 \ RNU \ OD^{-1}$ -> from paper

* $T_{GFPm} = 2 h$ -> from paper

### Explanation and Assumptions:

* Time constant for GFP Maturation = 2.0h for wild type GFP and 0.45 hour for EGFP -> Based on paper

* Maturation $m$ is considered as a first order reaction

* $GFP$ degradation follows Michaelis-Menten kinetics, and responsible proteases don't differentiate between $n$ and $f$

* $K_M$ represents the combined GFP content per cell (i.e., $^nGFP+ ^fGFP$ per cell) at which the sum of $D_n$ and $D_f$ equals $\frac {1}{2} \cdot D_{max}$

### Legend:

* $^nGFP$ or $n$: Cell content of non-fluorescent GFP
* $^fGFP$ or $f$: Cell content of fluorescent GFP
* $t$: Time ($hours$)
* $m$: Maturation constant for $^nGFP$ ($/hour$)
* $\mu$: Growth rate of cell ($/hour$)
* $D_n$: Degradation rate of $^nGFP$ ($/hour$)
* $D_f$: Degradation rate of $^fGFP$ ($/hour$)
* $K_M$: Saturation constant
* $T_{GFPm}$: time constant for GFP Maturation

## Python Model

### Start out by setting up our model and assumed constants below
"""

"""
iGEM 2019 GFP Expression Model
"""
import math

# Constants
P_BSN = 10
P_GFP_MAX = 10
D_MAX = 232
K_A = 35
K_B = 20
K_C = 0.1
K_M = 35
T_GFP_M = 0.01
M = math.log(2) / T_GFP_M
MU = 0.5
TXN_ENV = 1

# Equations
def model(y, t):
  """
  Differentials for model
  """
  gfp_n, gfp_f, bsn, txn = y
  
  # degradations
  D_BSN = D_MAX * bsn / (bsn + K_A)
  Dn = D_MAX * gfp_n / (gfp_n + gfp_f + K_M)
  Df = D_MAX * gfp_f / (gfp_n + gfp_f + K_M)
  
  # Biosensor
  dBSNdt = P_BSN / bsn - D_BSN
  bsn_a = bsn / (1 + (K_B/ txn))
  
  # GFP Promoter
  p_gfp = 1 / (1+ (K_C / bsn_a))
  
  # fluorescent and non-fluorescent GFP
  dgfp_ndt = p_gfp - M*gfp_n - MU * gfp_n - Dn
  dgfp_fdt = M*gfp_n - MU * gfp_f - Df
  
  # toxin concentration in cell decreases as it binds to biosensor
  dtxndt = -bsn_a + TXN_ENV/txn
 
  
  return [dgfp_ndt, dgfp_fdt, dBSNdt, dtxndt]

"""### Solve when no toxin is present"""

import numpy as np
from scipy.integrate import odeint
import matplotlib.pyplot as plt

# initial conditions
y0 = [0.1, 0.1, 0.1, 0.1]

# time points
t = np.linspace(0,12)

# solve ODE and plot results
gfp = odeint(model, y0, t)
plt.plot(t,gfp[:,0],label="Non-Fluorescent GFP")
plt.plot(t,gfp[:,1],label="Fluorescent GFP")
plt.plot(t,gfp[:,2],label="GFP promoter")
plt.plot(t,gfp[:,3],label="Active Biosensor")
# plt.plot(t,gfp[:,4],label="Inactive Biosensor")

# plt.ylabel('GFP Expression')
plt.xlabel('Time')
plt.legend(loc='best')
plt.show()

"""### When Toxin is Present:"""

TXN_ENV = 1
import numpy as np
from scipy.integrate import odeint
import matplotlib.pyplot as plt

# initial conditions
y0 = [0.001, 0.001, 0.001, 0.1] # prevent divide by zero erros

# time points
t = np.linspace(0,30)

# solve ODE and plot results
gfp = odeint(model, y0, t)
plt.plot(t,gfp[:,0],label="Non-Fluorescent GFP")
plt.plot(t,gfp[:,1],label="Fluorescent GFP")
# plt.plot(t,gfp[:,2],label="Active Biosensor")
plt.plot(t,gfp[:,2],label="Inactive Biosensor")
# plt.plot(t,gfp[:,3],label="Toxin")


# plt.ylabel('GFP Expression')
plt.xlabel('Time')
plt.legend(loc='best')
plt.show()

"""## Future Experiments to Run

##Saxitoxin Diffusion Model:

In the future it would be interesting to model the diffusion of saxitoxin across the cell membrane. We would model and experimentally determine the uptake and intracellular dynamics of saxitoxin across mammalian cells. We could use techniques similar to those in a study done calculating the diffusion and reactions of lipophilic compounds in complex cells.

## Validation and Constant Determining Experiments

##References:

GFP Model: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC95514/

E.coli Growth Rate: https://www.ncbi.nlm.nih.gov/pubmed/9111915

Similar Model from Northwestern: http://2018.igem.org/Team:Northwestern/Model

Biosensor + Luminescence paper: http://www.journals.vu.lt/nonlinear-analysis/article/view/14471/13387

Cell Diffusion Model: https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0023128
"""
